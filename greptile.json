{
  "strictness": 2,
  "commentTypes": ["logic", "syntax"],
  "triggerOnUpdates": true,
  "fixWithAI": true,
  "statusCheck": true,
  "statusCommentsEnabled": true,
  "ignoreKeywords": "typo\ncopy edit\nchore(release)",
  "ignorePatterns": "**/node_modules/**\n**/dist/**\n**/*.min.*\n**/*.png\n**/*.jpg\n**/*.jpeg\n**/*.svg\n**/*.ico\n**/*.lock\nCHANGELOG.md\nweb/CHANGELOG.md\nweb/server/protocol/*-upstream/**/*.txt",
  "instructions": "Prioritize high-signal issues: bugs, protocol regressions, state-loss risks, security flaws, and missing tests tied to changed behavior. Avoid style-only nitpicks unless they hide correctness problems.",
  "customContext": {
    "files": [
      {
        "path": "CLAUDE.md",
        "description": "Project operating constraints and required testing/Playground expectations."
      },
      {
        "path": "WEBSOCKET_PROTOCOL_REVERSED.md",
        "description": "Reverse-engineered CLI protocol contract used by ws bridge and browser clients.",
        "scope": [
          "web/server/ws-bridge.ts",
          "web/server/session-types.ts",
          "web/src/ws.ts",
          "web/src/store.ts",
          "web/server/cli-launcher.ts"
        ]
      },
      {
        "path": "README.md",
        "description": "High-level project behavior and development workflow."
      },
      {
        "path": "web/CODEX_MAPPING.md",
        "description": "Codex compatibility mapping and integration context.",
        "scope": [
          "web/**"
        ]
      }
    ],
    "rules": [
      {
        "scope": [
          "web/server/**/*.ts"
        ],
        "rule": "For backend behavior changes, require matching Vitest coverage in web/server/*.test.ts for success paths, failure paths, and edge cases."
      },
      {
        "scope": [
          "web/src/**/*.ts",
          "web/src/**/*.tsx"
        ],
        "rule": "For frontend behavior changes, require matching tests in web/src/**/*.test.ts(x) and avoid introducing client/server type drift."
      },
      {
        "scope": [
          "web/src/components/**/*.tsx"
        ],
        "rule": "When changing message/chat-flow components (MessageBubble, ToolBlock, PermissionBanner, Composer, MessageFeed, ChatView, streaming/tool states), ensure Playground mocks are updated in web/src/components/Playground.tsx."
      },
      {
        "scope": [
          "web/server/ws-bridge.ts",
          "web/server/session-types.ts",
          "web/src/ws.ts",
          "web/src/store.ts"
        ],
        "rule": "Treat websocket message shapes and event semantics as a compatibility contract; flag dropped/renamed fields, reordered state transitions, or reconnect behavior changes without explicit migration and tests."
      },
      {
        "scope": [
          "web/server/session-store.ts",
          "web/server/cli-launcher.ts",
          "web/server/ws-bridge.ts",
          "web/server/session-types.ts"
        ],
        "rule": "Session persistence must remain backward compatible across restarts/resume flows; new persisted fields need safe defaults and old persisted data must still load."
      },
      {
        "scope": [
          "web/server/routes.ts",
          "web/server/cli-launcher.ts",
          "web/server/container-manager.ts",
          "web/server/path-resolver.ts",
          "web/server/git-utils.ts"
        ],
        "rule": "Flag command-injection, path traversal, unsafe shell interpolation, or unvalidated filesystem writes. Prefer explicit allowlists, path normalization, and argument-array process spawning."
      },
      {
        "scope": [
          "web/server/**/*.ts",
          "web/src/**/*.ts",
          "web/src/**/*.tsx"
        ],
        "rule": "Features must work for both Codex and Claude Code. If implemented for only one backend, require clear UI gating and disabled/hidden incompatible actions."
      }
    ],
    "other": [
      {
        "scope": [
          "web/server/**/*.ts"
        ],
        "content": "This backend bridges browser and CLI websockets with per-session state. Reconnection, permission pending state, and message history durability are critical."
      },
      {
        "scope": [
          "web/src/**/*.tsx",
          "web/src/**/*.ts"
        ],
        "content": "Frontend uses Zustand state keyed by session ID and relies on typed websocket events. Review for stale state, race conditions, and multi-session bleed-through."
      },
      {
        "scope": [
          "web/server/protocol/**/*.ts",
          "web/server/protocol/**/*.txt"
        ],
        "content": "Protocol snapshots represent upstream contracts. Reviewers should prioritize drift detection and adapter safety over formatting concerns."
      }
    ]
  }
}
